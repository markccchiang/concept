#!/bin/bash

# This script performs a basic test of the CONCEPT code.
# It runs the code with no snapshot or powerspectrum times
# in both pure Python and compiled mode.

# Initialize test environment
this_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "${this_dir}/../environment"

# Clean and run in pure Python with different number of cpus
(cd "${concept_dir}" && make clean)
"${run}" -p "${this_dir}/params_pure_python" --pure-python --local
"${run}" -n 1 -p "${this_dir}/params_pure_python" --pure-python --local
"${run}" -n 2 -p "${this_dir}/params_pure_python" --pure-python --local
"${run}" -n 4 -p "${this_dir}/params_pure_python" --pure-python --local

# Build and run in compiled mode with different number of cpus
"${run}" -p "${this_dir}/params" --local
"${run}" -n 1 -p "${this_dir}/params" --local
"${run}" -n 2 -p "${this_dir}/params" --local
"${run}" -n 4 -p "${this_dir}/params" --local

# Finalize test environment
test_done=true source "${this_dir}/../environment"

